{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nodeloc/lottery/webpack/bootstrap","webpack://@nodeloc/lottery/webpack/runtime/compat get default export","webpack://@nodeloc/lottery/webpack/runtime/define property getters","webpack://@nodeloc/lottery/webpack/runtime/hasOwnProperty shorthand","webpack://@nodeloc/lottery/webpack/runtime/make namespace object","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/app']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/extend']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/components/Badge']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/models/Discussion']\"","webpack://@nodeloc/lottery/./src/forum/addDiscussionBadge.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/components/ReplyComposer']\"","webpack://@nodeloc/lottery/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nodeloc/lottery/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@nodeloc/lottery/./src/forum/components/CreateLotteryModal.js","webpack://@nodeloc/lottery/./src/forum/addComposerItems.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/Component']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/helpers/avatar']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/helpers/username']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/components/Link']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@nodeloc/lottery/./src/forum/components/ListVotersModal.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@nodeloc/lottery/./src/forum/components/EditLotteryModal.js","webpack://@nodeloc/lottery/./src/forum/components/PostLottery.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@nodeloc/lottery/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['forum/utils/PostControls']\"","webpack://@nodeloc/lottery/./src/forum/components/index.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/Model']\"","webpack://@nodeloc/lottery/./src/forum/models/Lottery.js","webpack://@nodeloc/lottery/./src/forum/models/LotteryOption.js","webpack://@nodeloc/lottery/./src/forum/models/LotteryVote.js","webpack://@nodeloc/lottery/./src/forum/models/index.js","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/extenders']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/models/Post']\"","webpack://@nodeloc/lottery/external root \"flarum.core.compat['common/models/Forum']\"","webpack://@nodeloc/lottery/./src/forum/extend.js","webpack://@nodeloc/lottery/./src/forum/index.js","webpack://@nodeloc/lottery/./src/forum/addLotteryControls.js","webpack://@nodeloc/lottery/./src/forum/addLotteryToPost.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Badge'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Discussion'];","import app from 'flarum/forum/app';\r\n\r\nimport { extend } from 'flarum/common/extend';\r\nimport Badge from 'flarum/common/components/Badge';\r\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\r\nimport Discussion from 'flarum/common/models/Discussion';\r\n\r\nexport default () => {\r\n  extend(DiscussionList.prototype, 'requestParams', (params) => {\r\n    params.include.push('lottery');\r\n  });\r\n\r\n  extend(Discussion.prototype, 'badges', function (badges) {\r\n    if (this.hasLottery()) {\r\n      badges.add(\r\n        'lottery',\r\n        Badge.component({\r\n          type: 'lottery',\r\n          label: app.translator.trans('nodeloc-lottery.forum.tooltip.badge'),\r\n          icon: 'fas fa-gift',\r\n        }),\r\n        5\r\n      );\r\n    }\r\n  });\r\n};\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ReplyComposer'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","import app from 'flarum/forum/app';\r\n\r\nimport Button from 'flarum/common/components/Button';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport Switch from 'flarum/common/components/Switch';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport extractText from 'flarum/common/utils/extractText';\r\n\r\nexport default class CreateLotteryModal extends Modal {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    this.options = [Stream(''), Stream('')];\r\n    this.optionImageUrls = [Stream(''), Stream('')];\r\n\r\n    this.question = Stream('');\r\n\r\n    this.endDate = Stream();\r\n\r\n    this.publicLottery = Stream(false);\r\n    this.hideVotes = Stream(false);\r\n    this.allowChangeVote = Stream(true);\r\n    this.allowMultipleVotes = Stream(false);\r\n    this.maxVotes = Stream(0);\r\n\r\n    this.datepickerMinDate = this.formatDate(undefined);\r\n\r\n    const { lottery } = this.attrs;\r\n\r\n    // When re-opening the modal for the same discussion composer where we already set lottery attributes\r\n    if (lottery && Array.isArray(lottery.options)) {\r\n      this.options = [];\r\n      this.optionImageUrls = [];\r\n      lottery.options.forEach((option) => {\r\n        this.options.push(Stream(option.answer));\r\n        this.optionImageUrls.push(Stream(option.imageUrl));\r\n      });\r\n\r\n      this.question(lottery.question);\r\n      this.publicLottery(lottery.publicLottery);\r\n      this.hideVotes(lottery.hideVotes);\r\n      this.allowChangeVote(lottery.allowChangeVote);\r\n      this.allowMultipleVotes(lottery.allowMultipleVotes);\r\n      this.maxVotes(lottery.maxVotes || 0);\r\n\r\n      this.endDate(this.formatDate(lottery.endDate));\r\n\r\n      // Replace minimum of 'today' for lottery end date only if the lottery is not already closed\r\n      if (this.endDate() && dayjs(lottery.endDate).isAfter(dayjs())) {\r\n        this.datepickerMinDate = this.formatDate(lottery.endDate);\r\n      }\r\n    }\r\n  }\r\n\r\n  title() {\r\n    return app.translator.trans('nodeloc-lottery.forum.modal.add_title');\r\n  }\r\n\r\n  className() {\r\n    return 'LotteryDiscussionModal Modal--medium';\r\n  }\r\n\r\n  content() {\r\n    return [\r\n      <div className=\"Modal-body\">\r\n        <div className=\"LotteryDiscussionModal-form\">{this.fields().toArray()}</div>\r\n      </div>,\r\n    ];\r\n  }\r\n\r\n  fields() {\r\n    const items = new ItemList();\r\n\r\n    items.add(\r\n      'question',\r\n      <div className=\"Form-group\">\r\n        <label className=\"label\">{app.translator.trans('nodeloc-lottery.forum.modal.lottery_placeholder')}</label>\r\n\r\n        <input type=\"text\" name=\"question\" className=\"FormControl\" bidi={this.question} />\r\n      </div>,\r\n      100\r\n    );\r\n\r\n    items.add(\r\n      'answers',\r\n      <div className=\"LotteryModal--answers Form-group\">\r\n        <label className=\"label LotteryModal--answers-title\">\r\n          <span>{app.translator.trans('nodeloc-lottery.forum.modal.options_label')}</span>\r\n\r\n          {Button.component({\r\n            className: 'Button LotteryModal--button small',\r\n            icon: 'fas fa-plus',\r\n            onclick: this.addOption.bind(this),\r\n          })}\r\n        </label>\r\n\r\n        {this.displayOptions()}\r\n      </div>,\r\n      80\r\n    );\r\n\r\n    items.add(\r\n      'date',\r\n      <div className=\"Form-group\">\r\n        <label className=\"label\">{app.translator.trans('nodeloc-lottery.forum.modal.date_placeholder')}</label>\r\n\r\n        <div className=\"LotteryModal--date\">\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"datetime-local\"\r\n            name=\"date\"\r\n            bidi={this.endDate}\r\n            min={this.datepickerMinDate}\r\n            max={this.formatDate('2038')}\r\n          />\r\n          {Button.component({\r\n            className: 'Button LotteryModal--button',\r\n            icon: 'fas fa-times',\r\n            onclick: this.endDate.bind(this, null),\r\n          })}\r\n        </div>\r\n\r\n        {this.endDate() && (\r\n          <p className=\"helpText\">\r\n            <i class=\"icon fas fa-clock\" />\r\n            &nbsp;\r\n            {dayjs(this.endDate()).isBefore(dayjs())\r\n              ? app.translator.trans('nodeloc-lottery.forum.lottery_ended')\r\n              : app.translator.trans('nodeloc-lottery.forum.days_remaining', { time: dayjs(this.endDate()).fromNow() })}\r\n          </p>\r\n        )}\r\n      </div>,\r\n      40\r\n    );\r\n\r\n    items.add(\r\n      'public',\r\n      <div className=\"Form-group\">\r\n        {Switch.component(\r\n          {\r\n            state: this.publicLottery() || false,\r\n            onchange: this.publicLottery,\r\n          },\r\n          app.translator.trans('nodeloc-lottery.forum.modal.public_lottery_label')\r\n        )}\r\n      </div>,\r\n      20\r\n    );\r\n\r\n    items.add(\r\n      'hide-votes',\r\n      <div className=\"Form-group\">\r\n        <Switch state={this.endDate() && this.hideVotes()} onchange={this.hideVotes} disabled={!this.endDate()}>\r\n          {app.translator.trans('nodeloc-lottery.forum.modal.hide_votes_label')}\r\n        </Switch>\r\n      </div>,\r\n      20\r\n    );\r\n\r\n    items.add(\r\n      'allow-change-vote',\r\n      <div className=\"Form-group\">\r\n        <Switch state={this.allowChangeVote()} onchange={this.allowChangeVote}>\r\n          {app.translator.trans('nodeloc-lottery.forum.modal.allow_change_vote_label')}\r\n        </Switch>\r\n      </div>,\r\n      20\r\n    );\r\n\r\n    items.add(\r\n      'allow-multiple-votes',\r\n      <div className=\"Form-group\">\r\n        {Switch.component(\r\n          {\r\n            state: this.allowMultipleVotes() || false,\r\n            onchange: this.allowMultipleVotes,\r\n          },\r\n          app.translator.trans('nodeloc-lottery.forum.modal.allow_multiple_votes_label')\r\n        )}\r\n      </div>,\r\n      15\r\n    );\r\n\r\n    if (this.allowMultipleVotes()) {\r\n      items.add(\r\n        'max-votes',\r\n        <div className=\"Form-group\">\r\n          <label className=\"label\">{app.translator.trans('nodeloc-lottery.forum.modal.max_votes_label')}</label>\r\n\r\n          <input type=\"number\" min=\"0\" max={this.options.length} name=\"maxVotes\" className=\"FormControl\" bidi={this.maxVotes} />\r\n\r\n          <p className=\"helpText\">{app.translator.trans('nodeloc-lottery.forum.modal.max_votes_help')}</p>\r\n        </div>,\r\n        15\r\n      );\r\n    }\r\n\r\n    items.add(\r\n      'submit',\r\n      <div className=\"Form-group\">\r\n        {Button.component(\r\n          {\r\n            type: 'submit',\r\n            className: 'Button Button--primary LotteryModal-SubmitButton',\r\n            loading: this.loading,\r\n          },\r\n          app.translator.trans('nodeloc-lottery.forum.modal.submit')\r\n        )}\r\n      </div>,\r\n      -10\r\n    );\r\n\r\n    return items;\r\n  }\r\n\r\n  displayOptions() {\r\n    return Object.keys(this.options).map((el, i) => (\r\n      <div className=\"Form-group\">\r\n        <fieldset className=\"Lottery-answer-input\">\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"text\"\r\n            name={'answer' + (i + 1)}\r\n            bidi={this.options[i]}\r\n            placeholder={app.translator.trans('nodeloc-lottery.forum.modal.option_placeholder') + ' #' + (i + 1)}\r\n          />\r\n          {app.forum.attribute('allowLotteryOptionImage') ? (\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"text\"\r\n              name={'answerImage' + (i + 1)}\r\n              bidi={this.optionImageUrls[i]}\r\n              placeholder={app.translator.trans('nodeloc-lottery.forum.modal.image_option_placeholder') + ' #' + (i + 1)}\r\n            />\r\n          ) : null}\r\n        </fieldset>\r\n        {i >= 2\r\n          ? Button.component({\r\n              type: 'button',\r\n              className: 'Button Button--warning LotteryModal--button',\r\n              icon: 'fas fa-minus',\r\n              onclick: i >= 2 ? this.removeOption.bind(this, i) : '',\r\n            })\r\n          : ''}\r\n      </div>\r\n    ));\r\n  }\r\n\r\n  addOption() {\r\n    const max = Math.max(app.forum.attribute('lotteryMaxOptions'), 2);\r\n\r\n    if (this.options.length < max) {\r\n      this.options.push(Stream(''));\r\n      this.optionImageUrls.push(Stream(''));\r\n    } else {\r\n      alert(extractText(app.translator.trans('nodeloc-lottery.forum.modal.max', { max })));\r\n    }\r\n  }\r\n\r\n  removeOption(option) {\r\n    this.options.splice(option, 1);\r\n    this.optionImageUrls.splice(option, 1);\r\n  }\r\n\r\n  data() {\r\n    const lottery = {\r\n      question: this.question(),\r\n      endDate: this.dateToTimestamp(this.endDate()),\r\n      publicLottery: this.publicLottery(),\r\n      hideVotes: this.hideVotes(),\r\n      allowChangeVote: this.allowChangeVote(),\r\n      allowMultipleVotes: this.allowMultipleVotes(),\r\n      maxVotes: this.maxVotes(),\r\n      options: [],\r\n    };\r\n\r\n    this.options.forEach((answer, index) => {\r\n      if (answer()) {\r\n        lottery.options.push({\r\n          answer: answer(),\r\n          imageUrl: this.optionImageUrls[index](),\r\n        });\r\n      }\r\n    });\r\n\r\n    if (this.question() === '') {\r\n      alert(app.translator.trans('nodeloc-lottery.forum.modal.include_question'));\r\n\r\n      return null;\r\n    }\r\n\r\n    if (lottery.options.length < 2) {\r\n      alert(app.translator.trans('nodeloc-lottery.forum.modal.min'));\r\n\r\n      return null;\r\n    }\r\n\r\n    return lottery;\r\n  }\r\n\r\n  onsubmit(e) {\r\n    e.preventDefault();\r\n\r\n    const data = this.data();\r\n\r\n    if (data === null) {\r\n      return;\r\n    }\r\n\r\n    const promise = this.attrs.onsubmit(data);\r\n\r\n    if (promise instanceof Promise) {\r\n      this.loading = true;\r\n\r\n      promise.then(this.hide.bind(this), (err) => {\r\n        console.error(err);\r\n        this.onerror(err);\r\n        this.loaded();\r\n      });\r\n    } else {\r\n      app.modal.close();\r\n    }\r\n  }\r\n\r\n  formatDate(date, def = false) {\r\n    const dayjsDate = dayjs(date);\r\n\r\n    if (date === false || !dayjsDate.isValid()) return def !== false ? this.formatDate(def) : null;\r\n\r\n    return dayjsDate.format('YYYY-MM-DDTHH:mm');\r\n  }\r\n\r\n  dateToTimestamp(date) {\r\n    const dayjsDate = dayjs(date);\r\n\r\n    if (!date || !dayjsDate.isValid()) return false;\r\n\r\n    return dayjsDate.format();\r\n  }\r\n}\r\n","import app from 'flarum/forum/app';\r\n\r\nimport { extend } from 'flarum/common/extend';\r\nimport classList from 'flarum/common/utils/classList';\r\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\r\nimport ReplyComposer from 'flarum/forum/components/ReplyComposer';\r\n\r\nimport CreateLotteryModal from './components/CreateLotteryModal';\r\n\r\nexport const addToComposer = (composer) => {\r\n  composer.prototype.addLottery = function () {\r\n    app.modal.show(CreateLotteryModal, {\r\n      lottery: this.composer.fields.lottery,\r\n      onsubmit: (lottery) => (this.composer.fields.lottery = lottery),\r\n    });\r\n  };\r\n\r\n  // Add button to DiscussionComposer header\r\n  extend(composer.prototype, 'headerItems', function (items) {\r\n    const discussion = this.composer.body?.attrs?.discussion;\r\n    const canStartLottery = discussion?.canStartLottery() ?? app.forum.canStartLottery();\r\n    if (canStartLottery) {\r\n      items.add(\r\n        'lottery',\r\n        <a className=\"ComposerBody-lottery\" onclick={this.addLottery.bind(this)}>\r\n          <span className={classList('LotteryLabel', !this.composer.fields.lottery && 'none')}>\r\n            {app.translator.trans(`nodeloc-lottery.forum.composer_discussion.${this.composer.fields.lottery ? 'edit' : 'add'}_lottery`)}\r\n          </span>\r\n        </a>,\r\n        1\r\n      );\r\n    }\r\n  });\r\n\r\n  extend(composer.prototype, 'data', function (data) {\r\n    if (this.composer.fields.lottery) {\r\n      data.lottery = this.composer.fields.lottery;\r\n    }\r\n  });\r\n};\r\n\r\nexport default () => {\r\n  addToComposer(DiscussionComposer);\r\n  addToComposer(ReplyComposer);\r\n};\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/CommentPost'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/avatar'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/username'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","import app from 'flarum/forum/app';\r\n\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport username from 'flarum/common/helpers/username';\r\nimport Link from 'flarum/common/components/Link';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\n\r\nexport default class ListVotersModal extends Modal {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    this.loading = Stream(true);\r\n\r\n    app.store\r\n      .find('nodeloc/lottery', this.attrs.lottery.id(), {\r\n        include: 'votes,votes.user,votes.option',\r\n      })\r\n      .then(() => this.loading(false))\r\n      .finally(() => m.redraw());\r\n  }\r\n\r\n  className() {\r\n    return 'Modal--medium VotesModal';\r\n  }\r\n\r\n  title() {\r\n    return app.translator.trans('nodeloc-lottery.forum.votes_modal.title');\r\n  }\r\n\r\n  content() {\r\n    return <div className=\"Modal-body\">{this.loading() ? <LoadingIndicator /> : this.attrs.lottery.options().map(this.optionContent.bind(this))}</div>;\r\n  }\r\n\r\n  optionContent(opt) {\r\n    const votes = (this.attrs.lottery.votes() || []).filter((v) => opt.id() === v.option().id());\r\n\r\n    return (\r\n      <div className=\"VotesModal-option\">\r\n        <h2>{opt.answer() + ':'}</h2>\r\n\r\n        {votes.length ? (\r\n          <div className=\"VotesModal-list\">{votes.map(this.voteContent.bind(this))}</div>\r\n        ) : (\r\n          <h4>{app.translator.trans('nodeloc-lottery.forum.modal.no_voters')}</h4>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  voteContent(vote) {\r\n    const user = vote.user();\r\n    const attrs = user && { href: app.route.user(user) };\r\n\r\n    return (\r\n      <Link {...attrs}>\r\n        {avatar(user)} {username(user)}\r\n      </Link>\r\n    );\r\n  }\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import app from 'flarum/forum/app';\r\n\r\nimport Button from 'flarum/common/components/Button';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport extractText from 'flarum/common/utils/extractText';\r\nimport CreateLotteryModal from './CreateLotteryModal';\r\n\r\nexport default class EditLotteryModal extends CreateLotteryModal {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    this.lottery = this.attrs.lottery;\r\n\r\n    this.options = this.lottery.options();\r\n    this.optionAnswers = this.options.map((o) => Stream(o.answer()));\r\n    this.optionImageUrls = this.options.map((o) => Stream(o.imageUrl()));\r\n    this.question = Stream(this.lottery.question());\r\n    this.endDate = Stream(this.formatDate(this.lottery.endDate()));\r\n    this.publicLottery = Stream(this.lottery.publicLottery());\r\n    this.allowMultipleVotes = Stream(this.lottery.allowMultipleVotes());\r\n    this.hideVotes = Stream(this.lottery.hideVotes());\r\n    this.allowChangeVote = Stream(this.lottery.allowChangeVote());\r\n    this.maxVotes = Stream(this.lottery.maxVotes() || 0);\r\n\r\n    if (this.endDate() && dayjs(this.lottery.endDate()).isAfter(dayjs())) {\r\n      this.datepickerMinDate = this.formatDate(this.endDate());\r\n    }\r\n  }\r\n\r\n  title() {\r\n    return app.translator.trans('nodeloc-lottery.forum.modal.edit_title');\r\n  }\r\n\r\n  displayOptions() {\r\n    return this.options.map((opt, i) => (\r\n      <div className=\"Form-group\">\r\n        <fieldset className=\"Lottery-answer-input\">\r\n          <input\r\n            className=\"FormControl\"\r\n            type=\"text\"\r\n            name={'answer' + (i + 1)}\r\n            bidi={this.optionAnswers[i]}\r\n            placeholder={app.translator.trans('nodeloc-lottery.forum.modal.option_placeholder') + ' #' + (i + 1)}\r\n          />\r\n          {app.forum.attribute('allowLotteryOptionImage') ? (\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"text\"\r\n              name={'answerImage' + (i + 1)}\r\n              bidi={this.optionImageUrls[i]}\r\n              placeholder={app.translator.trans('nodeloc-lottery.forum.modal.image_option_placeholder') + ' #' + (i + 1)}\r\n            />\r\n          ) : null}\r\n        </fieldset>\r\n\r\n        {i >= 2\r\n          ? Button.component({\r\n              type: 'button',\r\n              className: 'Button LotteryModal--button',\r\n              icon: 'fas fa-minus',\r\n              onclick: i >= 2 ? this.removeOption.bind(this, i) : '',\r\n            })\r\n          : ''}\r\n      </div>\r\n    ));\r\n  }\r\n\r\n  addOption() {\r\n    const max = Math.max(app.forum.attribute('lotteryMaxOptions'), 2);\r\n\r\n    if (this.options.length < max) {\r\n      this.options.push(app.store.createRecord('lottery_options'));\r\n      this.optionAnswers.push(Stream(''));\r\n      this.optionImageUrls.push(Stream(''));\r\n    } else {\r\n      alert(extractText(app.translator.trans('nodeloc-lottery.forum.modal.max', { max })));\r\n    }\r\n  }\r\n\r\n  removeOption(i) {\r\n    this.options.splice(i, 1);\r\n    this.optionAnswers.splice(i, 1);\r\n    this.optionImageUrls.splice(i, 1);\r\n  }\r\n\r\n  data() {\r\n    const options = this.options.map((o, i) => {\r\n      if (!o.data.attributes) o.data.attributes = {};\r\n\r\n      o.data.attributes.answer = this.optionAnswers[i]();\r\n      o.data.attributes.imageUrl = this.optionImageUrls[i]();\r\n\r\n      return o.data;\r\n    });\r\n\r\n    return {\r\n      question: this.question(),\r\n      endDate: this.dateToTimestamp(this.endDate()),\r\n      publicLottery: this.publicLottery(),\r\n      hideVotes: this.hideVotes(),\r\n      allowChangeVote: this.allowChangeVote(),\r\n      allowMultipleVotes: this.allowMultipleVotes(),\r\n      maxVotes: this.maxVotes(),\r\n      options,\r\n    };\r\n  }\r\n\r\n  onsubmit(e) {\r\n    e.preventDefault();\r\n\r\n    if (this.loading) return;\r\n\r\n    this.loading = true;\r\n\r\n    return this.lottery\r\n      .save(this.data())\r\n      .then(() => {\r\n        this.hide();\r\n        m.redraw();\r\n      })\r\n      .catch((e) => {\r\n        this.loaded();\r\n        this.onerror(e);\r\n      });\r\n  }\r\n}\r\n","import app from 'flarum/forum/app';\r\n\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LogInModal from 'flarum/forum/components/LogInModal';\r\nimport ListVotersModal from './ListVotersModal';\r\nimport classList from 'flarum/common/utils/classList';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport Tooltip from 'flarum/common/components/Tooltip';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport EditLotteryModal from './EditLotteryModal';\r\n\r\nexport default class PostLottery extends Component {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    this.loadingOptions = false;\r\n\r\n    this.useSubmitUI = !this.attrs.lottery?.canChangeVote() && this.attrs.lottery?.allowMultipleVotes();\r\n    this.pendingSubmit = false;\r\n    this.pendingOptions = null;\r\n  }\r\n\r\n  oncreate(vnode) {\r\n    super.oncreate(vnode);\r\n\r\n    this.preventClose = this.preventClose.bind(this);\r\n    window.addEventListener('beforeunload', this.preventClose);\r\n  }\r\n\r\n  onremove(vnode) {\r\n    super.onremove(vnode);\r\n\r\n    window.removeEventListener('beforeunload', this.preventClose);\r\n  }\r\n\r\n  view() {\r\n    const lottery = this.attrs.lottery;\r\n    const options = lottery.options() || [];\r\n    let maxVotes = lottery.allowMultipleVotes() ? lottery.maxVotes() : 1;\r\n\r\n    if (maxVotes === 0) maxVotes = options.length;\r\n\r\n    const infoItems = this.infoItems(maxVotes);\r\n\r\n    return (\r\n      <div className=\"Post-lottery\" data-id={lottery.id()}>\r\n        <div className=\"LotteryHeading\">\r\n          <h3 className=\"LotteryHeading-title\">{lottery.question()}</h3>\r\n\r\n          {lottery.canSeeVoters() && (\r\n            <Tooltip text={app.translator.trans('nodeloc-lottery.forum.public_lottery')}>\r\n              <Button className=\"Button LotteryHeading-voters\" onclick={this.showVoters.bind(this)} icon=\"fas fa-lottery\" />\r\n            </Tooltip>\r\n          )}\r\n\r\n          {lottery.canEdit() && (\r\n            <Tooltip text={app.translator.trans('nodeloc-lottery.forum.moderation.edit')}>\r\n              <Button className=\"Button LotteryHeading-edit\" onclick={app.modal.show.bind(app.modal, EditLotteryModal, { lottery })} icon=\"fas fa-pen\" />\r\n            </Tooltip>\r\n          )}\r\n          {lottery.canDelete() && (\r\n            <Tooltip text={app.translator.trans('nodeloc-lottery.forum.moderation.delete')}>\r\n              <Button className=\"Button LotteryHeading-delete\" onclick={this.deleteLottery.bind(this)} icon=\"fas fa-trash\" />\r\n            </Tooltip>\r\n          )}\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"LotteryOptions\">{options.map(this.viewOption.bind(this))}</div>\r\n\r\n          <div className=\"Lottery-sticky\">\r\n            {!infoItems.isEmpty() && <div className=\"helpText LotteryInfoText\">{infoItems.toArray()}</div>}\r\n\r\n            {this.useSubmitUI && this.pendingSubmit && (\r\n              <Button className=\"Button Button--primary Lottery-submit\" loading={this.loadingOptions} onclick={this.onsubmit.bind(this)}>\r\n                {app.translator.trans('nodeloc-lottery.forum.lottery.submit_button')}\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  infoItems(maxVotes) {\r\n    const items = new ItemList();\r\n    const lottery = this.attrs.lottery;\r\n    const hasVoted = lottery.myVotes()?.length > 0;\r\n\r\n    if (app.session.user && !lottery.canVote() && !lottery.hasEnded()) {\r\n      items.add(\r\n        'no-permission',\r\n        <span>\r\n          <i className=\"icon fas fa-times-circle fa-fw\" />\r\n          {app.translator.trans('nodeloc-lottery.forum.no_permission')}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    if (lottery.endDate()) {\r\n      items.add(\r\n        'end-date',\r\n        <span>\r\n          <i class=\"icon fas fa-clock fa-fw\" />\r\n          {lottery.hasEnded()\r\n            ? app.translator.trans('nodeloc-lottery.forum.lottery_ended')\r\n            : app.translator.trans('nodeloc-lottery.forum.days_remaining', { time: dayjs(lottery.endDate()).fromNow() })}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    if (lottery.canVote()) {\r\n      items.add(\r\n        'max-votes',\r\n        <span>\r\n          <i className=\"icon fas fa-lottery fa-fw\" />\r\n          {app.translator.trans('nodeloc-lottery.forum.max_votes_allowed', { max: maxVotes })}\r\n        </span>\r\n      );\r\n\r\n      if (!lottery.canChangeVote()) {\r\n        items.add(\r\n          'cannot-change-vote',\r\n          <span>\r\n            <i className={`icon fas fa-${hasVoted ? 'times' : 'exclamation'}-circle fa-fw`} />\r\n            {app.translator.trans('nodeloc-lottery.forum.lottery.cannot_change_vote')}\r\n          </span>\r\n        );\r\n      }\r\n    }\r\n\r\n    return items;\r\n  }\r\n\r\n  viewOption(opt) {\r\n    const lottery = this.attrs.lottery;\r\n    const hasVoted = lottery.myVotes()?.length > 0;\r\n    const totalVotes = lottery.voteCount();\r\n\r\n    const voted = this.pendingOptions ? this.pendingOptions.has(opt.id()) : lottery.myVotes()?.some?.((vote) => vote.option() === opt);\r\n    const votes = opt.voteCount();\r\n    const percent = totalVotes > 0 ? Math.round((votes / totalVotes) * 100) : 0;\r\n\r\n    // isNaN(null) is false, so we have to check type directly now that API always returns the field\r\n    const canSeeVoteCount = typeof votes === 'number';\r\n    const isDisabled = this.loadingOptions || (hasVoted && !lottery.canChangeVote());\r\n    const width = canSeeVoteCount ? percent : (Number(voted) / (lottery.myVotes()?.length || 1)) * 100;\r\n\r\n    const showCheckmark = !app.session.user || (!lottery.hasEnded() && lottery.canVote() && (!hasVoted || lottery.canChangeVote()));\r\n\r\n    const bar = (\r\n      <div className=\"LotteryBar\" data-selected={!!voted} style={`--lottery-option-width: ${width}%`}>\r\n        {showCheckmark && (\r\n          <label className=\"LotteryAnswer-checkbox checkbox\">\r\n            <input onchange={this.changeVote.bind(this, opt)} type=\"checkbox\" checked={voted} disabled={isDisabled} />\r\n            <span className=\"checkmark\" />\r\n          </label>\r\n        )}\r\n\r\n        <div className=\"LotteryAnswer-text\">\r\n          <span className=\"LotteryAnswer-text-answer\">{opt.answer()}</span>\r\n          {voted && !showCheckmark && icon('fas fa-check-circle', { className: 'LotteryAnswer-check' })}\r\n          {canSeeVoteCount && <span className={classList('LotteryPercent', percent !== 100 && 'LotteryPercent--option')}>{percent}%</span>}\r\n        </div>\r\n\r\n        {opt.imageUrl() ? <img className=\"LotteryAnswer-image\" src={opt.imageUrl()} alt={opt.answer()} /> : null}\r\n      </div>\r\n    );\r\n\r\n    return (\r\n      <div\r\n        className={classList('LotteryOption', hasVoted && 'LotteryVoted', lottery.hasEnded() && 'LotteryEnded', opt.imageUrl() && 'LotteryOption-hasImage')}\r\n        data-id={opt.id()}\r\n      >\r\n        {canSeeVoteCount ? (\r\n          <Tooltip text={app.translator.trans('nodeloc-lottery.forum.tooltip.votes', { count: votes })} onremove={this.hideOptionTooltip}>\r\n            {bar}\r\n          </Tooltip>\r\n        ) : (\r\n          bar\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  changeVote(option, evt) {\r\n    if (!app.session.user) {\r\n      app.modal.show(LogInModal);\r\n      evt.target.checked = false;\r\n      return;\r\n    }\r\n\r\n    const optionIds = this.pendingOptions || new Set(this.attrs.lottery.myVotes().map?.((v) => v.option().id()));\r\n    const isUnvoting = optionIds.delete(option.id());\r\n    const allowsMultiple = this.attrs.lottery.allowMultipleVotes();\r\n\r\n    if (!allowsMultiple) {\r\n      optionIds.clear();\r\n    }\r\n\r\n    if (!isUnvoting) {\r\n      optionIds.add(option.id());\r\n    }\r\n\r\n    if (this.useSubmitUI) {\r\n      this.pendingOptions = optionIds.size ? optionIds : null;\r\n      this.pendingSubmit = !!this.pendingOptions;\r\n      return;\r\n    }\r\n\r\n    return this.submit(optionIds, null, () => (evt.target.checked = isUnvoting));\r\n  }\r\n\r\n  onsubmit() {\r\n    return this.submit(this.pendingOptions, () => {\r\n      this.pendingOptions = null;\r\n      this.pendingSubmit = false;\r\n    });\r\n  }\r\n\r\n  submit(optionIds, cb, onerror) {\r\n    this.loadingOptions = true;\r\n    m.redraw();\r\n\r\n    return app\r\n      .request({\r\n        method: 'PATCH',\r\n        url: `${app.forum.attribute('apiUrl')}/nodeloc/lottery/${this.attrs.lottery.id()}/votes`,\r\n        body: {\r\n          data: {\r\n            optionIds: Array.from(optionIds),\r\n          },\r\n        },\r\n      })\r\n      .then((res) => {\r\n        app.store.pushPayload(res);\r\n        cb?.();\r\n      })\r\n      .catch((err) => {\r\n        onerror?.(err);\r\n      })\r\n      .finally(() => {\r\n        this.loadingOptions = false;\r\n\r\n        m.redraw();\r\n      });\r\n  }\r\n\r\n  showVoters() {\r\n    // Load all the votes only when opening the votes list\r\n    app.modal.show(ListVotersModal, {\r\n      lottery: this.attrs.lottery,\r\n      post: this.attrs.post,\r\n    });\r\n  }\r\n\r\n  deleteLottery() {\r\n    if (confirm(app.translator.trans('nodeloc-lottery.forum.moderation.delete_confirm'))) {\r\n      this.attrs.lottery.delete().then(() => {\r\n        m.redraw.sync();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attempting to use the `tooltipVisible` attr on the Tooltip component set to 'false' when no vote count\r\n   * caused the tooltip to break on click. This is a workaround to hide the tooltip when no vote count is available,\r\n   * called on 'onremove' of the Tooltip component. It doesn't always work as intended either, but it does the job.\r\n   */\r\n  hideOptionTooltip(vnode) {\r\n    vnode.attrs.tooltipVisible = false;\r\n    vnode.state.updateVisibility();\r\n  }\r\n\r\n  /**\r\n   * Alert before navigating away using browser's 'beforeunload' event\r\n   */\r\n  preventClose(e) {\r\n    if (this.pendingOptions) {\r\n      e.preventDefault();\r\n      return true;\r\n    }\r\n  }\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/PostControls'];","import CreateLotteryModal from './CreateLotteryModal';\r\nimport PostLottery from './PostLottery';\r\nimport EditLotteryModal from './EditLotteryModal';\r\nimport ListVotersModal from './ListVotersModal';\r\n\r\nexport const components = {\r\n  CreateLotteryModal: CreateLotteryModal,\r\n  PostLottery: PostLottery,\r\n  EditLotteryModal: EditLotteryModal,\r\n  ListVotersModal,\r\n};\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\r\n\r\nexport default class Lottery extends Model {\r\n  question = Model.attribute('question');\r\n  hasEnded = Model.attribute('hasEnded');\r\n  endDate = Model.attribute('endDate');\r\n\r\n  publicLottery = Model.attribute('publicLottery');\r\n  hideVotes = Model.attribute('hideVotes');\r\n  allowChangeVote = Model.attribute('allowChangeVote');\r\n  allowMultipleVotes = Model.attribute('allowMultipleVotes');\r\n  maxVotes = Model.attribute('maxVotes');\r\n\r\n  voteCount = Model.attribute('voteCount');\r\n\r\n  canVote = Model.attribute('canVote');\r\n  canEdit = Model.attribute('canEdit');\r\n  canDelete = Model.attribute('canDelete');\r\n  canSeeVoters = Model.attribute('canSeeVoters');\r\n  canChangeVote = Model.attribute('canChangeVote');\r\n\r\n  options = Model.hasMany('options');\r\n  votes = Model.hasMany('votes');\r\n  myVotes = Model.hasMany('myVotes');\r\n\r\n  apiEndpoint() {\r\n    return `/nodeloc/lottery${this.exists ? `/${this.data.id}` : ''}`;\r\n  }\r\n}\r\n","import Model from 'flarum/common/Model';\r\n\r\nexport default class LotteryOption extends Model {\r\n  answer = Model.attribute('answer');\r\n  imageUrl = Model.attribute('imageUrl');\r\n  voteCount = Model.attribute('voteCount');\r\n\r\n  lottery = Model.hasOne('lottery');\r\n  votes = Model.hasMany('votes');\r\n\r\n  apiEndpoint() {\r\n    return `/nodeloc/lottery/answers${this.exists ? `/${this.data.id}` : ''}`;\r\n  }\r\n}\r\n","import Model from 'flarum/common/Model';\r\n\r\nexport default class LotteryVote extends Model {\r\n  lottery = Model.hasOne('lottery');\r\n  option = Model.hasOne('option');\r\n  user = Model.hasOne('user');\r\n\r\n  lotteryId = Model.attribute('lotteryId');\r\n  optionId = Model.attribute('optionId');\r\n\r\n  apiEndpoint() {\r\n    return `/nodeloc/lottery/${this.lotteryId()}/vote`;\r\n  }\r\n}\r\n","import Lottery from './Lottery';\r\nimport LotteryOption from './LotteryOption';\r\nimport LotteryVote from './LotteryVote';\r\n\r\nexport const models = {\r\n  Poll: Lottery,\r\n  PollOption: LotteryOption,\r\n  PollVote: LotteryVote,\r\n};\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Post'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Forum'];","import Extend from 'flarum/common/extenders';\r\nimport Post from 'flarum/common/models/Post';\r\nimport Forum from 'flarum/common/models/Forum';\r\nimport Discussion from 'flarum/common/models/Discussion';\r\nimport Lottery from './models/Lottery';\r\nimport LotteryOption from './models/LotteryOption';\r\nimport LotteryVote from './models/LotteryVote';\r\n\r\nexport default [\r\n  new Extend.Store().add('lottery', Lottery).add('lottery_options', LotteryOption).add('lottery_votes', LotteryVote),\r\n  new Extend.Model(Post).hasMany('lottery').attribute('canStartLottery'),\r\n  new Extend.Model(Forum).attribute('canStartLottery'),\r\n  new Extend.Model(Discussion).attribute('hasLottery').attribute('canStartLottery'),\r\n];\r\n","import app from 'flarum/forum/app';\r\n\r\nimport addDiscussionBadge from './addDiscussionBadge';\r\nimport addComposerItems from './addComposerItems';\r\nimport addLotteryToPost from './addLotteryToPost';\r\nimport addLotteryControls from './addLotteryControls';\r\n\r\nexport * from './components';\r\nexport * from './models';\r\n\r\napp.initializers.add('nodeloc/lottery', () => {\r\n  addDiscussionBadge();\r\n  addComposerItems();\r\n  addLotteryToPost();\r\n  addLotteryControls();\r\n});\r\n\r\nexport { default as extend } from './extend';\r\n","import app from 'flarum/forum/app';\r\n\r\nimport { extend } from 'flarum/common/extend';\r\nimport PostControls from 'flarum/forum/utils/PostControls';\r\nimport CreateLotteryModal from './components/CreateLotteryModal';\r\nimport Button from 'flarum/common/components/Button';\r\n\r\nexport default () => {\r\n  const createLottery = (post) =>\r\n    app.modal.show(CreateLotteryModal, {\r\n      onsubmit: (data) =>\r\n        app.store\r\n          .createRecord('lottery')\r\n          .save(\r\n            {\r\n              ...data,\r\n              relationships: {\r\n                post,\r\n              },\r\n            },\r\n            {\r\n              data: {\r\n                include: 'options,myVotes,myVotes.option',\r\n              },\r\n            }\r\n          )\r\n          .then((lottery) => {\r\n            post.rawRelationship('lottery')?.push?.({ type: 'lottery', id: lottery.id() });\r\n            return lottery;\r\n          }),\r\n    });\r\n\r\n  extend(PostControls, 'moderationControls', function (items, post) {\r\n    if (!post.isHidden() && post.canStartLottery()) {\r\n      items.add(\r\n        'addLottery',\r\n        <Button icon=\"fas fa-lottery\" onclick={createLottery.bind(this, post)}>\r\n          {app.translator.trans('nodeloc-lottery.forum.moderation.add')}\r\n        </Button>\r\n      );\r\n    }\r\n  });\r\n};\r\n","import app from 'flarum/forum/app';\r\n\r\nimport { extend } from 'flarum/common/extend';\r\nimport CommentPost from 'flarum/forum/components/CommentPost';\r\nimport PostLottery from './components/PostLottery';\r\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\r\n\r\nexport default () => {\r\n  extend(CommentPost.prototype, 'content', function (content) {\r\n    const post = this.attrs.post;\r\n\r\n    if ((!post.isHidden() || this.revealContent) && post.lottery()) {\r\n      for (const lottery of post.lottery()) {\r\n        if (lottery) {\r\n          content.push(<PostLottery post={post} lottery={lottery} />);\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  extend(CommentPost.prototype, 'oninit', function () {\r\n    this.subtree.check(() => {\r\n      const lottery = this.attrs.post.lottery();\r\n\r\n      const checks = lottery?.map?.(\r\n        (lottery) =>\r\n          lottery && [\r\n            lottery.data?.attributes,\r\n            lottery.options().map?.((option) => option?.data?.attributes),\r\n            lottery.myVotes().map?.((vote) => vote.option()?.id()),\r\n          ]\r\n      );\r\n\r\n      return JSON.stringify(checks);\r\n    });\r\n  });\r\n\r\n  extend(DiscussionPage.prototype, 'oncreate', function () {\r\n    if (app.pusher) {\r\n      app.pusher.then((binding) => {\r\n        // We will listen for updates to all lottery and options\r\n        // Even if that model is not in the current discussion, it doesn't really matter\r\n        binding.channels.main.bind('updatedLotteryOptions', (data) => {\r\n          const lottery = app.store.getById('lottery', data['lotteryId']);\r\n\r\n          if (lottery) {\r\n            lottery.pushAttributes({\r\n              voteCount: data['lotteryVoteCount'],\r\n            });\r\n\r\n            // Not redrawing here, as the option below should trigger the redraw already\r\n          }\r\n\r\n          const changedOptions = data['options'];\r\n\r\n          for (const optionId in changedOptions) {\r\n            const option = app.store.getById('lottery_options', optionId);\r\n\r\n            if (option && option.voteCount() !== undefined) {\r\n              option.pushAttributes({\r\n                voteCount: changedOptions[optionId],\r\n              });\r\n            }\r\n          }\r\n\r\n          m.redraw();\r\n        });\r\n      });\r\n    }\r\n  });\r\n\r\n  extend(DiscussionPage.prototype, 'onremove', function () {\r\n    if (app.pusher) {\r\n      app.pusher.then((binding) => {\r\n        binding.channels.main.unbind('updatedLotteryOptions');\r\n      });\r\n    }\r\n  });\r\n};\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","CreateLotteryModal","_Modal","apply","arguments","_proto","oninit","vnode","_this","this","options","Stream","optionImageUrls","question","endDate","publicLottery","hideVotes","allowChangeVote","allowMultipleVotes","maxVotes","datepickerMinDate","formatDate","undefined","lottery","attrs","Array","isArray","forEach","option","push","answer","imageUrl","dayjs","isAfter","title","app","trans","className","content","m","fields","toArray","items","ItemList","add","type","name","bidi","Button","icon","onclick","addOption","displayOptions","min","max","class","isBefore","time","fromNow","Switch","state","onchange","disabled","length","loading","_this2","keys","map","el","i","placeholder","attribute","removeOption","Math","alert","extractText","splice","data","_this3","dateToTimestamp","index","onsubmit","e","_this4","preventDefault","promise","Promise","then","hide","err","console","error","onerror","loaded","close","date","def","dayjsDate","isValid","format","Modal","addToComposer","composer","addLottery","show","extend","_this$composer$body","_discussion$canStartL","discussion","body","canStartLottery","classList","ListVotersModal","find","id","include","redraw","LoadingIndicator","optionContent","opt","votes","filter","v","voteContent","vote","user","href","Link","avatar","username","EditLotteryModal","_CreateLotteryModal","optionAnswers","createRecord","attributes","save","PostLottery","_Component","_this$attrs$lottery","_this$attrs$lottery2","loadingOptions","useSubmitUI","canChangeVote","pendingSubmit","pendingOptions","oncreate","preventClose","window","addEventListener","onremove","removeEventListener","view","infoItems","canSeeVoters","Tooltip","text","showVoters","canEdit","canDelete","deleteLottery","viewOption","isEmpty","_lottery$myVotes","hasVoted","myVotes","canVote","hasEnded","_lottery$myVotes2","_lottery$myVotes3","_lottery$myVotes4","totalVotes","voteCount","voted","has","some","percent","round","canSeeVoteCount","isDisabled","width","Number","showCheckmark","bar","style","changeVote","checked","src","alt","count","hideOptionTooltip","evt","_this$attrs$lottery$m","_this$attrs$lottery$m2","LogInModal","target","optionIds","Set","isUnvoting","clear","size","submit","cb","method","url","from","res","pushPayload","post","confirm","sync","tooltipVisible","updateVisibility","Component","_extends","assign","source","components","Lottery","_Model","_len","args","_key","concat","Model","apiEndpoint","exists","LotteryOption","LotteryVote","lotteryId","optionId","models","Poll","PollOption","PollVote","Extend","Post","hasMany","Forum","Discussion","createLottery","DiscussionList","params","badges","hasLottery","Badge","label","DiscussionComposer","ReplyComposer","CommentPost","isHidden","revealContent","_step","_iterator","_createForOfIteratorHelperLoose","done","subtree","check","checks","_lottery$data","_lottery$options$map","_lottery$options","_lottery$myVotes$map","_option$data","_vote$option","JSON","stringify","DiscussionPage","binding","channels","main","getById","pushAttributes","changedOptions","unbind","relationships","_post$rawRelationship","rawRelationship","PostControls"],"sourceRoot":""}