(()=>{var t={n:o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return t.d(a,{a}),a},d:(o,a)=>{for(var e in a)t.o(a,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:a[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{components:()=>X,extend:()=>pt,models:()=>rt});const a=flarum.core.compat["forum/app"];var e=t.n(a);const r=flarum.core.compat["common/extend"],n=flarum.core.compat["common/components/Badge"];var s=t.n(n);const i=flarum.core.compat["forum/components/DiscussionList"];var l=t.n(i);const c=flarum.core.compat["common/models/Discussion"];var p=t.n(c);const u=flarum.core.compat["common/utils/classList"];var d=t.n(u);const h=flarum.core.compat["forum/components/DiscussionComposer"];var f=t.n(h);function y(t,o){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},y(t,o)}function v(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,y(t,o)}flarum.core.compat["forum/components/ReplyComposer"];const _=flarum.core.compat["common/components/Button"];var b=t.n(_);const g=flarum.core.compat["common/components/Modal"];var w=t.n(g);flarum.core.compat["common/components/Switch"];const M=flarum.core.compat["common/utils/ItemList"];var D=t.n(M);const N=flarum.core.compat["common/utils/Stream"];var x=t.n(N);const L=flarum.core.compat["common/utils/extractText"];var S=t.n(L);const B=flarum.core.compat["common/components/Select"];var C=t.n(B),O=function(t){function o(){for(var o,a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];return(o=t.call.apply(t,[this].concat(r))||this).select_options={discussions_started:e().translator.trans("nodeloc-lottery.forum.modal.discussions_started"),posts_made:e().translator.trans("nodeloc-lottery.forum.modal.posts_made"),money:e().translator.trans("nodeloc-lottery.forum.modal.money"),lotteries_made:e().translator.trans("nodeloc-lottery.forum.modal.lotteries_made")},o}v(o,t);var a=o.prototype;return a.oninit=function(o){var a=this;t.prototype.oninit.call(this,o),this.operator_type=[x()("discussions_started")],this.operator=[x()("1")],this.operator_value=[x()("1")],this.prizes=x()(""),this.price=x()(""),this.amount=x()(""),this.endDate=x()(),this.allowCancleEnter=x()(!0),this.min_participants=x()(0),this.max_participants=x()(999999),this.datepickerMinDate=this.formatDate(void 0);var e=this.attrs.lottery;e&&Array.isArray(e.options)&&(this.operator_type=[],this.operator=[],this.operator_value=[],e.options.forEach((function(t){a.operator_type.push(x()(t.operator_type)),a.operator.push(x()(t.operator)),a.operator_value.push(x()(t.operator_value))})),this.prizes(e.prizes),this.price(e.price),this.amount(e.amount),this.allowCancleEnter(e.allowCancleEnter),this.min_participants(e.min_participants||0),this.max_participants(e.max_participants||999999),this.endDate(this.formatDate(e.endDate)),this.endDate()&&dayjs(e.endDate).isAfter(dayjs())&&(this.datepickerMinDate=this.formatDate(e.endDate)))},a.title=function(){return e().translator.trans("nodeloc-lottery.forum.modal.add_title")},a.className=function(){return"LotteryDiscussionModal Modal--medium"},a.content=function(){return[m("div",{className:"Modal-body"},m("div",{className:"LotteryDiscussionModal-form"},this.fields().toArray()))]},a.fields=function(){var t=new(D());return t.add("prizes",m("div",{className:"Form-group"},m("label",{className:"label"},e().translator.trans("nodeloc-lottery.forum.modal.lottery_placeholder")),m("input",{type:"text",name:"prizes",className:"FormControl",bidi:this.prizes})),100),t.add("price",m("div",{className:"Form-group"},m("label",{className:"label"},e().translator.trans("nodeloc-lottery.forum.modal.price")),m("input",{type:"number",min:"1",name:"price",className:"FormControl",bidi:this.price})),100),t.add("amount",m("div",{className:"Form-group"},m("label",{className:"label"},e().translator.trans("nodeloc-lottery.forum.modal.amount")),m("input",{type:"number",min:"1",name:"amount",className:"FormControl",bidi:this.amount})),100),t.add("conditions",m("div",{className:"LotteryModal--answers Form-group"},m("label",{className:"label LotteryModal--answers-title"},m("span",null,e().translator.trans("nodeloc-lottery.forum.modal.options_label")),b().component({className:"Button LotteryModal--button small",icon:"fas fa-plus",onclick:this.addOption.bind(this)})),this.displayOptions()),80),t.add("date",m("div",{className:"Form-group"},m("label",{className:"label"},e().translator.trans("nodeloc-lottery.forum.modal.date_placeholder")),m("div",{className:"LotteryModal--date"},m("input",{className:"FormControl",type:"datetime-local",name:"date",bidi:this.endDate,min:this.datepickerMinDate,max:this.formatDate("2038")}),b().component({className:"Button LotteryModal--button",icon:"fas fa-times",onclick:this.endDate.bind(this,null)})),this.endDate()&&m("p",{className:"helpText"},m("i",{class:"icon fas fa-clock"})," ",dayjs(this.endDate()).isBefore(dayjs())?e().translator.trans("nodeloc-lottery.forum.lottery_ended"):e().translator.trans("nodeloc-lottery.forum.days_remaining",{time:dayjs(this.endDate()).fromNow()}))),40),t.add("min-participants",m("div",{className:"Form-group MinMaxSelector"},m("label",{className:"label"},e().translator.trans("nodeloc-lottery.forum.modal.participants_help")),m("div",{class:"MinMaxSelector--inputs"},m("input",{type:"number",min:"0",name:"min_participants",className:"FormControl",bidi:this.min_participants}),m("button",{class:"Button hasIcon",type:"button"},m("i",{"aria-hidden":"true",class:"icon fas fa-less-than-equal Button-icon"}),m("span",{class:"Button-label"})),m("input",{class:"FormControl MinMaxSelector--placeholder",disabled:!0,placeholder:e().translator.trans("nodeloc-lottery.forum.modal.participants_label")}),m("button",{class:"Button hasIcon",type:"button"},m("i",{"aria-hidden":"true",class:"icon fas fa-less-than-equal Button-icon"}),m("span",{class:"Button-label"})),m("input",{type:"number",max:"999999",name:"max_participants",className:"FormControl",bidi:this.max_participants}))),15),t.add("submit",m("div",{className:"Form-group"},b().component({type:"submit",className:"Button Button--primary LotteryModal-SubmitButton",loading:this.loading},e().translator.trans("nodeloc-lottery.forum.modal.submit"))),-10),t},a.displayOptions=function(){var t=this;return Object.keys(this.operator_value).map((function(o,a){return m("div",{className:"Form-group MinMaxSelector"},m("fieldset",{className:"MinMaxSelector--inputs"},m("span",{class:"Select"},C().component({options:t.select_options,value:t.operator_type[a](),onchange:function(o){t.operator_type[a](o)}}),m("i",{"aria-hidden":"true",class:"icon fas fa-sort Select-caret"})),m("button",{class:"Button hasIcon",type:"button",onclick:function(){return t.operator[a](0===t.operator[a]()?1:0)}},0===t.operator[a]()?m("i",{"aria-hidden":"true",class:"icon fas fa-less-than-equal Button-icon"}):m("i",{"aria-hidden":"true",class:"icon fas fa-greater-than-equal Button-icon"}),m("span",{class:"Button-label"})),m("input",{className:"FormControl",type:"number",name:"operatorvalue"+(a+1),bidi:t.operator_value[a],placeholder:e().translator.trans("nodeloc-lottery.forum.modal.option_placeholder")+" #"+(a+1)})),a>=2?b().component({type:"button",className:"Button Button--warning LotteryModal--button",icon:"fas fa-minus",onclick:a>=1?t.removeOption.bind(t,a):""}):"")}))},a.addOption=function(){this.operator_value.length<5?(this.operator_type.push(x()("money")),this.operator.push(x()("1")),this.operator_value.push(x()("1"))):alert(S()(e().translator.trans("nodeloc-lottery.forum.modal.max",{max:5})))},a.removeOption=function(t){this.operator_type.splice(t,1),this.operator.splice(t,1),this.operator_value.splice(t,1)},a.data=function(){var t=this,o={prizes:this.prizes(),price:this.price(),amount:this.amount(),endDate:this.dateToTimestamp(this.endDate()),allowCancelEnter:this.allowCancleEnter(),min_participants:this.min_participants(),max_participants:this.max_participants(),options:[]};return this.operator_value.forEach((function(a,e){a()&&o.options.push({operator_type:t.operator_type[e](),operator:t.operator[e](),operator_value:a()})})),""===this.prizes()?(alert(e().translator.trans("nodeloc-lottery.forum.modal.include_prizes")),null):""===this.price()?(alert(e().translator.trans("nodeloc-lottery.forum.modal.include_price")),null):""===this.amount()?(alert(e().translator.trans("nodeloc-lottery.forum.modal.include_amount")),null):o.options.length<1?(alert(e().translator.trans("nodeloc-lottery.forum.modal.min")),null):""===this.endDate()?(alert(e().translator.trans("nodeloc-lottery.forum.modal.include_end_date")),null):o},a.onsubmit=function(t){var o=this;t.preventDefault();var a=this.data();if(null!==a){var r=this.attrs.onsubmit(a);r instanceof Promise?(this.loading=!0,r.then(this.hide.bind(this),(function(t){console.error(t),o.onerror(t),o.loaded()}))):e().modal.close()}},a.formatDate=function(t,o){void 0===o&&(o=!1);var a=dayjs(t);return!1!==t&&a.isValid()?a.format("YYYY-MM-DDTHH:mm"):!1!==o?this.formatDate(o):null},a.dateToTimestamp=function(t){var o=dayjs(t);return!(!t||!o.isValid())&&o.format()},o}(w());const E=flarum.core.compat["forum/components/CommentPost"];var I=t.n(E);const k=flarum.core.compat["common/Component"];var P=t.n(k);const j=flarum.core.compat["forum/components/LogInModal"];var T=t.n(j);const z=flarum.core.compat["common/helpers/avatar"];var F=t.n(z);const A=flarum.core.compat["common/helpers/username"];var H=t.n(A);const q=flarum.core.compat["common/components/Link"];var U=t.n(q);const Y=flarum.core.compat["common/components/LoadingIndicator"];var V=t.n(Y),R=function(t){function o(){return t.apply(this,arguments)||this}v(o,t);var a=o.prototype;return a.oninit=function(o){var a=this;t.prototype.oninit.call(this,o),this.loading=x()(!0),e().store.find("nodeloc/lottery",this.attrs.lottery.id(),{include:"participants,participants.user,participants.status"}).then((function(){return a.loading(!1)})).finally((function(){return m.redraw()}))},a.className=function(){return"Modal--medium ParticipantsModal"},a.title=function(){return e().translator.trans("nodeloc-lottery.forum.participants_modal.title"+(this.attrs.lottery.hasEnded()?"_winners":""))},a.content=function(){return m("div",{className:"Modal-body"},this.loading()?m(V(),null):this.optionContent())},a.optionContent=function(){var t=this.attrs.lottery.participants();return m("div",{className:"ParticipantsModal-option"},t.length?m("div",{className:"ParticipantsModal-list"},t.map(this.participantsContent.bind(this))):m("h4",null,e().translator.trans("nodeloc-lottery.forum.modal.no_participants")))},a.participantsContent=function(t){var o=t.user();if(this.attrs.lottery.hasEnded()&&1!==t.status())return null;var a=o&&{href:e().route.user(o)};return m(U(),a,F()(o)," ",H()(o))},o}(w());const $=flarum.core.compat["common/components/Tooltip"];var G=t.n($);flarum.core.compat["common/helpers/icon"];var J=function(t){function o(){return t.apply(this,arguments)||this}v(o,t);var a=o.prototype;return a.oninit=function(o){t.prototype.oninit.call(this,o),this.lottery=this.attrs.lottery,this.options=this.lottery.options(),this.operator_type=this.options.map((function(t){return x()(t.operator_type())})),this.operator=this.options.map((function(t){return x()(t.operator())})),this.operator_value=this.options.map((function(t){return x()(t.operator_value())})),this.prizes=x()(this.lottery.prizes()),this.price=x()(this.lottery.price()),this.amount=x()(this.lottery.amount()),this.endDate=x()(this.formatDate(this.lottery.endDate())),this.min_participants=x()(this.lottery.min_participants()||0),this.max_participants=x()(this.lottery.max_participants()||999999),this.endDate()&&dayjs(this.lottery.endDate()).isAfter(dayjs())&&(this.datepickerMinDate=this.formatDate(this.endDate()))},a.title=function(){return e().translator.trans("nodeloc-lottery.forum.modal.edit_title")},a.displayOptions=function(){var t=this;return this.options.map((function(o,a){return m("div",{className:"Form-group MinMaxSelector"},m("fieldset",{className:"MinMaxSelector--inputs"},m("span",{class:"Select"},C().component({options:t.select_options,value:t.operator_type[a](),onchange:function(o){t.operator_type[a](o)}}),m("i",{"aria-hidden":"true",class:"icon fas fa-sort Select-caret"})),m("button",{class:"Button hasIcon",type:"button",onclick:function(){return t.operator[a](0===t.operator[a]()?1:0)}},0===t.operator[a]()?m("i",{"aria-hidden":"true",class:"icon fas fa-less-than-equal Button-icon"}):m("i",{"aria-hidden":"true",class:"icon fas fa-greater-than-equal Button-icon"}),m("span",{class:"Button-label"})),m("input",{className:"FormControl",type:"number",name:"operatorvalue"+(a+1),bidi:t.operator_value[a],placeholder:e().translator.trans("nodeloc-lottery.forum.modal.option_placeholder")+" #"+(a+1)})),a>=2?b().component({type:"button",className:"Button Button--warning LotteryModal--button",icon:"fas fa-minus",onclick:a>=1?t.removeOption.bind(t,a):""}):"")}))},a.addOption=function(){this.operator_value.length<5?(this.operator_type.push(x()("")),this.operator.push(x()("")),this.operator_value.push(x()("")),this.displayOptions()):alert(S()(e().translator.trans("nodeloc-lottery.forum.modal.max",{max:5})))},a.removeOption=function(t){this.operator_type.splice(t,1),this.operator.splice(t,1),this.operator_value.splice(t,1)},a.data=function(){var t=this,o=this.options.map((function(o,a){return o.data.attributes||(o.data.attributes={}),o.data.attributes.operator_type=t.operator_type[a](),o.data.attributes.operator=t.operator[a](),o.data.attributes.operator_value=t.operator_value[a](),o.data}));return{prizes:this.prizes(),price:this.price(),amount:this.amount(),endDate:this.dateToTimestamp(this.endDate()),min_participants:this.min_participants(),max_participants:this.max_participants(),options:o}},a.onsubmit=function(t){var o=this;if(t.preventDefault(),!this.loading)return this.loading=!0,this.lottery.save(this.data()).then((function(){o.hide(),m.redraw()})).catch((function(t){o.loaded(),o.onerror(t)}))},o}(O),K=function(t){function o(){return t.apply(this,arguments)||this}v(o,t);var a=o.prototype;return a.oninit=function(t){t.state.days=x()(),t.state.hours=x()(),t.state.minutes=x()(),t.state.seconds=x()()},a.oncreate=function(t){var o=t.attrs.endDate;!function(t,a){var r=document.getElementById("clockdiv"),n=r.querySelector(".days"),s=r.querySelector(".hours"),i=r.querySelector(".minutes"),l=r.querySelector(".seconds");function c(){var t=function(t){var o=Date.parse(t)-Date.parse(new Date),a=Math.floor(o/1e3%60),e=Math.floor(o/1e3/60%60),r=Math.floor(o/36e5%24);return{total:o,days:Math.floor(o/864e5),hours:r,minutes:e,seconds:a}}(o);if(n.innerHTML=t.days,s.innerHTML=("0"+t.hours).slice(-2),i.innerHTML=("0"+t.minutes).slice(-2),l.innerHTML=("0"+t.seconds).slice(-2),t.total<0){if(clearInterval(m),document.getElementById("titleEvent")){var a=document.getElementById("titleEvent");a.parentNode.removeChild(a)}var r=e().translator.trans("nodeloc-lottery.forum.endDateText");document.getElementById("clockdiv").innerHTML='<h1 class="letterpress">'+r+"</h1>"}}c();var m=setInterval((function(){return c()}),1e3)}()},a.view=function(t){var o=e().translator.trans("nodeloc-lottery.forum.days"),a=e().translator.trans("nodeloc-lottery.forum.hours"),r=e().translator.trans("nodeloc-lottery.forum.minutes"),n=e().translator.trans("nodeloc-lottery.forum.seconds"),s=e().forum.attribute("event_title")||e().translator.trans("nodeloc-lottery.forum.hurry_up"),i=e().forum.attribute("fontawesome_events_icon")||"fas fa-gift";return m("div",{class:"countdown-container"},m("h2",{class:"event-text",id:"titleEvent"},m("i",{class:i+" fontawicon"}),s),m("div",{id:"clockdiv"},m("div",{class:"cntdwn-widget"},m("span",{class:"days"},t.state.days()),m("div",{class:"smalltext"},o)),m("div",{class:"cntdwn-widget"},m("span",{class:"hours"},t.state.hours()),m("div",{class:"smalltext"},a)),m("div",{class:"cntdwn-widget"},m("span",{class:"minutes"},t.state.minutes()),m("div",{class:"smalltext"},r)),m("div",{class:"cntdwn-widget"},m("span",{class:"seconds"},t.state.seconds()),m("div",{class:"smalltext"},n))))},o}(P()),Q=function(t){function o(){for(var o,a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];return(o=t.call.apply(t,[this].concat(r))||this).select_options={discussions_started:e().translator.trans("nodeloc-lottery.forum.modal.discussions_started"),posts_made:e().translator.trans("nodeloc-lottery.forum.modal.posts_made"),money:e().translator.trans("nodeloc-lottery.forum.modal.money"),lotteries_made:e().translator.trans("nodeloc-lottery.forum.modal.lotteries_made")},o}v(o,t);var a=o.prototype;return a.oninit=function(o){var a;t.prototype.oninit.call(this,o),this.loadingOptions=!1,this.useSubmitUI=!(null!=(a=this.attrs.lottery)&&a.canCancelEnter())&&this.attrs.lottery,this.pendingSubmit=!1},a.oncreate=function(o){t.prototype.oncreate.call(this,o)},a.onremove=function(o){t.prototype.onremove.call(this,o)},a.view=function(){var t,o=this.attrs.lottery,a=o.options()||[],r=this.infoItems(),n=dayjs(o.endDate()),s=(null==(t=o.lottery_participants())?void 0:t.length)>0;return m("div",{className:"Post-lottery","data-id":o.id()},m("div",{className:"LotteryHeading"},m("h3",{className:"LotteryHeading-title"},o.prizes()),m(G(),{text:e().translator.trans("nodeloc-lottery.forum.public_lottery")},m(b(),{className:"Button LotteryHeading-voters",onclick:this.showparticipants.bind(this),icon:"fas fa-user"})),o.canEdit()&&m(G(),{text:e().translator.trans("nodeloc-lottery.forum.moderation.edit")},m(b(),{className:"Button LotteryHeading-edit",onclick:e().modal.show.bind(e().modal,J,{lottery:o}),icon:"fas fa-pen"})),o.canDelete()&&m(G(),{text:e().translator.trans("nodeloc-lottery.forum.moderation.delete")},m(b(),{className:"Button LotteryHeading-delete",onclick:this.deleteLottery.bind(this),icon:"fas fa-trash"}))),m("div",null,m("div",{className:"PrizeInfo"},m("div",{className:"PrizeDetails"},m("span",{class:"amount"},e().translator.trans("nodeloc-lottery.forum.modal.amount")," "),m("span",null,o.amount()),m("span",{class:"price"},e().translator.trans("nodeloc-lottery.forum.modal.price")),m("span",null,o.price()),0!==o.min_participants()&&m("[",null,m("span",{class:"min_participants"},e().translator.trans("nodeloc-lottery.forum.modal.min_participants")),m("span",null,o.min_participants())),o.max_participants()<9999&&m("[",null,m("span",{class:"min_participants"},e().translator.trans("nodeloc-lottery.forum.modal.max_participants")),m("span",null,o.max_participants()))),m(K,{endDate:n})),m("div",{className:"LotteryOptions"},o.min_participants()>0&&o.enterCount()&&m(".arrow",[m(".arrow-status",{style:{width:o.enterCount()>o.min_participants()?"100%":o.enterCount()/o.min_participants()*100+"%"}},[m("span.arrow-pointer","已有"+o.enterCount()+"人 / 最低"+o.min_participants()+"人")])]),m("h2",null,m("i",{class:"fas fa-info-circle fontawicon"})," ",e().translator.trans("nodeloc-lottery.forum.modal.options_label")),m("ul",null,a.map(this.viewOption.bind(this)))),m("div",{className:"Lottery-sticky"},!r.isEmpty()&&m("div",{className:"helpText LotteryInfoText"},r.toArray()),this.useSubmitUI&&!s&&m(b(),{className:"Button Button--primary Lottery-submit",loading:this.loadingOptions,onclick:this.onsubmit.bind(this)},e().translator.trans("nodeloc-lottery.forum.lottery.submit_button")))))},a.infoItems=function(){var t,o=new(D()),a=this.attrs.lottery,r=(null==(t=a.lottery_participants())?void 0:t.length)>0;return!e().session.user||a.canEnter()||a.hasEnded()||o.add("no-permission",m("span",null,m("i",{className:"icon fas fa-times-circle fa-fw"}),e().translator.trans("nodeloc-lottery.forum.no_permission"))),a.endDate()&&o.add("end-date",m("span",null,m("i",{class:"icon fas fa-clock fa-fw"}),a.hasEnded()?e().translator.trans("nodeloc-lottery.forum.lottery_ended"):e().translator.trans("nodeloc-lottery.forum.days_remaining",{time:dayjs(a.endDate()).fromNow()}))),r&&o.add("had-enter",m("span",null,m("i",{class:"icon fas fa-check-double fa-fw"}),e().translator.trans("nodeloc-lottery.forum.had_enter"))),o},a.viewOption=function(t){var o=this.select_options[t.operator_type()]||"",a=0===t.operator()?"<":">";return m("li",null,o,a,t.operator_value())},a.onsubmit=function(){var t=this;if(e().session.user)return this.submit((function(){t.pendingSubmit=!1}));e().modal.show(T())},a.submit=function(t,o,a){var r=this;return this.loadingOptions=!0,m.redraw(),e().request({method:"PATCH",url:e().forum.attribute("apiUrl")+"/nodeloc/lottery/"+this.attrs.lottery.id()+"/enter"}).then((function(t){e().store.pushPayload(t),null==o||o()})).catch((function(t){null==a||a(t)})).finally((function(){r.loadingOptions=!1,m.redraw()}))},a.showparticipants=function(){e().modal.show(R,{lottery:this.attrs.lottery,post:this.attrs.post})},a.deleteLottery=function(){confirm(e().translator.trans("nodeloc-lottery.forum.moderation.delete_confirm"))&&this.attrs.lottery.delete().then((function(){m.redraw.sync()}))},o}(P());function W(t,o){(null==o||o>t.length)&&(o=t.length);for(var a=0,e=new Array(o);a<o;a++)e[a]=t[a];return e}flarum.core.compat["forum/components/DiscussionPage"],flarum.core.compat["forum/utils/PostControls"];var X={CreateLotteryModal:O,PostLottery:Q,EditLotteryModal:J,ListVotersModal:R};const Z=flarum.core.compat["common/Model"];var tt=t.n(Z),ot=function(t){function o(){for(var o,a=arguments.length,e=new Array(a),r=0;r<a;r++)e[r]=arguments[r];return(o=t.call.apply(t,[this].concat(e))||this).prizes=tt().attribute("prizes"),o.hasEnded=tt().attribute("hasEnded"),o.endDate=tt().attribute("endDate"),o.price=tt().attribute("price"),o.amount=tt().attribute("amount"),o.min_participants=tt().attribute("min_participants"),o.max_participants=tt().attribute("max_participants"),o.enterCount=tt().attribute("enter_count"),o.status=tt().attribute("status"),o.canEnter=tt().attribute("canEnter"),o.canEdit=tt().attribute("canEdit"),o.canDelete=tt().attribute("canDelete"),o.canSeeParticipants=tt().attribute("canSeeParticipants"),o.canCancelEnter=tt().attribute("can_cancel_enter"),o.options=tt().hasMany("options"),o.participants=tt().hasMany("participants"),o.lottery_participants=tt().hasMany("lottery_participants"),o}return v(o,t),o.prototype.apiEndpoint=function(){return"/nodeloc/lottery"+(this.exists?"/"+this.data.id:"")},o}(tt()),at=function(t){function o(){for(var o,a=arguments.length,e=new Array(a),r=0;r<a;r++)e[r]=arguments[r];return(o=t.call.apply(t,[this].concat(e))||this).operator_type=tt().attribute("operator_type"),o.operator=tt().attribute("operator"),o.operator_value=tt().attribute("operator_value"),o.lottery=tt().hasOne("lottery"),o}return v(o,t),o.prototype.apiEndpoint=function(){return"/nodeloc/lottery/operator"+(this.exists?"/"+this.data.id:"")},o}(tt()),et=function(t){function o(){for(var o,a=arguments.length,e=new Array(a),r=0;r<a;r++)e[r]=arguments[r];return(o=t.call.apply(t,[this].concat(e))||this).lottery=tt().hasOne("lottery"),o.user=tt().hasOne("user"),o.status=tt().attribute("status"),o.lotteryId=tt().attribute("lotteryId"),o}return v(o,t),o.prototype.apiEndpoint=function(){return"/nodeloc/lottery/"+this.lotteryId()+"/enter"},o}(tt()),rt={Lottery:ot,LotteryOption:at,LotteryParticipants:et};const nt=flarum.core.compat["common/extenders"];var st=t.n(nt);const it=flarum.core.compat["common/models/Post"];var lt=t.n(it);const ct=flarum.core.compat["common/models/Forum"];var mt=t.n(ct);const pt=[(new(st().Store)).add("lottery",ot).add("lottery_options",at).add("lottery_participants",et),new(st().Model)(lt()).hasMany("lottery").attribute("canStartLottery"),new(st().Model)(mt()).attribute("canStartLottery"),new(st().Model)(p()).attribute("hasLottery").attribute("canStartLottery")];e().initializers.add("nodeloc/lottery",(function(){var t;(0,r.extend)(l().prototype,"requestParams",(function(t){t.include.push("lottery")})),(0,r.extend)(p().prototype,"badges",(function(t){this.hasLottery()&&t.add("lottery",s().component({type:"lottery",label:e().translator.trans("nodeloc-lottery.forum.tooltip.badge"),icon:"fas fa-gift"}),5)})),(t=f()).prototype.addLottery=function(){var t=this;e().modal.show(O,{lottery:this.composer.fields.lottery,onsubmit:function(o){return t.composer.fields.lottery=o}})},(0,r.extend)(t.prototype,"headerItems",(function(t){var o,a,r=null==(o=this.composer.body)||null==(o=o.attrs)?void 0:o.discussion;(null!=(a=null==r?void 0:r.canStartLottery())?a:e().forum.canStartLottery())&&t.add("lottery",m("a",{className:"ComposerBody-lottery",onclick:this.addLottery.bind(this)},m("span",{className:d()("LotteryLabel",!this.composer.fields.lottery&&"none")},e().translator.trans("nodeloc-lottery.forum.composer_discussion."+(this.composer.fields.lottery?"edit":"add")+"_lottery"))),1)})),(0,r.extend)(t.prototype,"data",(function(t){this.composer.fields.lottery&&(t.lottery=this.composer.fields.lottery)})),(0,r.extend)(I().prototype,"content",(function(t){var o=this.attrs.post;if((!o.isHidden()||this.revealContent)&&o.lottery())for(var a,e=function(t,o){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return(a=a.call(t)).next.bind(a);if(Array.isArray(t)||(a=function(t,o){if(t){if("string"==typeof t)return W(t,o);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?W(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){a&&(t=a);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o.lottery());!(a=e()).done;){var r=a.value;r&&t.push(m(Q,{post:o,lottery:r}))}}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map